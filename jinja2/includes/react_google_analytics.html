{#- This is the react-specific version of includes/google_analytics.html #}
{#- The user and waffle-related stuff has been moved to the client side. #}
<script>
    // Mozilla DNT Helper
    {% include "js/libs/mozilla.dnthelper.min.js" %}

    {%- if settings.GOOGLE_ANALYTICS_ACCOUNT %}
    {%- set GA_FILE = 'analytics_debug' if settings.DEBUG else 'analytics' %}

    // only load GA if DNT is not enabled
    if (Mozilla && !Mozilla.dntEnabled()) {
        window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
        ga('create', '{{ settings.GOOGLE_ANALYTICS_ACCOUNT }}', 'mozilla.org');
        ga('set', 'anonymizeIp', true);

        const gaSrc = 'https://www.google-analytics.com/{{ GA_FILE }}.js';
        const gaScript = document.createElement('script');
        gaScript.setAttribute('src', gaSrc);
        gaScript.setAttribute('async', true);
        document.head.appendChild(gaScript);
    }
    {%- endif %}
</script>
