!function(t,e,a){"use strict";function n(){var a=t("body");t("select.enable-if-js").removeAttr("disabled");var n=t("#translate-document");if(n.length&&(x=n,b=!0),a.hasClass("is-template")&&(C=1),a.is(".new")&&o(),t("details").length&&i(),a.is(".edit, .new, .translate")&&(r(),g(),!a.is(".is-template")&&window.waffle&&window.waffle.flag_is_active("dirtiness_tracking")&&_(),s(),v(),C||m(),l()),a.is(".edit.is-template")||a.is(".new.is-template")){var d=t("textarea#id_content").hide(),c=e.ace_editor=ace.edit("ace_content");c.setTheme("ace/theme/dreamweaver"),c.setBehavioursEnabled(!1);var u=require("ace/mode/javascript").Mode,h=c.getSession();h.setMode(new u),h.setValue(d.val()),h.on("change",function(){d.val(c.getSession().getValue())}),t(".ace_text-input").focus(),m()}}function i(){var e=function(t){var e,a,n,i=t.createElement("details");return"open"in i?(a=t.body||function(){var a=t.documentElement;return e=!0,a.insertBefore(t.createElement("body"),a.firstElementChild||a.firstChild)}(),i.innerHTML="<summary>a</summary>b",i.style.display="block",a.appendChild(i),n=i.offsetHeight,i.open=!0,n=n!=i.offsetHeight,a.removeChild(i),e&&a.parentNode.removeChild(a),n):!1}(document);e||t("details").addClass("no-details").each(function(){var e=t(this),n=t("summary",e),i=e.children(":not(summary)"),o=e.contents(":not(summary)");n.length||(n=t(a.createElement("summary")).text(gettext("Details")).prependTo(e)),i.length!==o.length&&(o.filter(function(){return 3===this.nodeType&&/[^\t\n\r ]/.test(this.data)}).wrap("<span>"),i=e.children(":not(summary)")),"undefined"!=typeof e.attr("open")?(e.addClass("open"),i.show()):i.hide(),n.attr("tabindex",0).attr("role","button").on("click",function(){n.focus(),"undefined"!=typeof e.attr("open")?(e.removeAttr("open"),n.attr("aria-expanded","false")):(e.attr("open","open"),n.attr("aria-expanded","true")),i.slideToggle(),e.toggleClass("open")}).on("keyup",function(t){(32==t.keyCode||13==t.keyCode)&&(t.preventDefault(),n.click())})})}function o(){var e={title:{id:"#id_slug",dependency_ids:["#id_title"],dependency_list:["#id_title"],maxLength:50}};t.each(e,function(e,a){t(a.id).addClass("prepopulated_field"),t(a.id).data("dependency_list",a.dependency_list).prepopulate(t(a.dependency_ids.join(",")),a.maxLength)})}function s(){t(".btn-preview").on("click",function(e){e.preventDefault();var a,n=" ",i=t("#id_title");if(CKEDITOR.instances.id_content)a=t.trim(CKEDITOR.instances.id_content.getSnapshot());else{if(!ace_editor||!ace_editor)return;a=t.trim(ace_editor.getSession().getValue())}if(i.length&&(n=i.val()),a){var o=t("<form action='"+t(this).attr("data-preview-url")+"' target='previewWin' method='POST' />").appendTo(document.body);t("<input type='hidden' name='content' />").val(a).appendTo(o),t("<input type='hidden' name='title' />").val(n).appendTo(o),t("#wiki-page-edit, #translate-document").find("input[name=csrfmiddlewaretoken]").clone().appendTo(o),o.get(0).submit(),o.remove()}return!1})}function r(){if(t("#article-head .metadata").length){var e=function(e){e.preventDefault(),t("#article-head .title").hide(),t("#article-head .metadata").show(),t("#article-head .metadata #id_title").focus()};t("#btn-properties").on("click",e),t("#edit-document .errorlist").each(e)}else t("#btn-properties").hide()}function l(){var e=t(".metadata-choose-parent"),a=t("#parent_id");e.each(function(){t(this).css("display","block"),t("#parent_text").mozillaAutocomplete({minLength:1,requireValidOption:!0,autocompleteUrl:mdn.wiki.autosuggestTitleUrl,_renderItemAsLink:!0,buildRequestData:function(t){return t.locale="en-US",t},onSelect:function(t){a.val(t.id)},onDeselect:function(){a.val("")}})})}function d(){var e,a=location.pathname.replace("$edit","");return b?(e="draft/translate"+a+"/"+location.search.replace("?tolocale=",""),e=e.replace("$translate","")):e=t("#id_current_rev").val()?"draft/edit"+a:"draft/new",C&&(e+="/template"),e=t.trim(e)}function c(e){var a,n=gettext('You have a draft in progress.  <a href="" class="restoreLink">Restore the draft content</a> or <a href="" class="discardLink">discard the draft</a>.'),i=t("#id_content");T=t('<div class="notice"><p>'+n+"</p></div>").insertBefore(i),T.find(".restoreLink").on("click",function(t){t.preventDefault(),i.val(e),C?(a=ace_editor,ace_editor.session.setValue(e)):(a=i.ckeditorGet(),a.setData(e)),a.focus(),h("loaded"),u()}),T.find(".discardLink").on("click",function(t){t.preventDefault(),u(),f()})}function u(){T&&T.css("display","none")}function g(){t(".btn-save").on("click",function(){return k&&f(),clearTimeout(w),x.attr("action","").removeAttr("target"),!0});var e=[];t(".btn-save-and-edit").on("click",function(){e.push(mdn.Notifier.growl("Saving changes…",{duration:0})),mdn.analytics.trackEvent({category:"Wiki",action:"Button",label:"Save and Keep Editing"});var t=x.find("textarea[name=content]").val();return k&&p(t),clearTimeout(w),x.attr("action","?iframe=1").attr("target","save-and-edit-target"),!0}),t(".btn-save-and-edit").show(),t("#save-and-edit-target").on("load",function(){if(e[0].success(null,2e3),e.shift(),k){var a=t(this).get(0).contentDocument;if("undefined"!=typeof a){var n=t("#iframe-response",a);"OK"==n.attr("data-status")?(localStorage.removeItem(y),x.find("input[name=current_rev]").val(n.attr("data-current-revision"))):x.add(a).hasClass("conflict")&&(x.attr("action","").attr("target",""),t(".btn-save").click())}}return t(".btn-save-and-edit").removeClass("loading"),t("#id_comment").val(""),x.data("disabled",!1).removeClass("disabled"),window.waffle&&window.waffle.flag_is_active("dirtiness_tracking")&&x.trigger("mdn:save-success"),!0}),x.on("submit",function(){mdn.optimizely.push(["trackEvent","editpage-submit"]),mdn.analytics.trackEvent({category:"Wiki",action:"Form submission",label:"Edit page"})})}function h(e){var a=new Date,n=a.toLocaleDateString()+" "+a.toLocaleTimeString();t("#draft-action").text(e),t("#draft-time").attr("title",a.toISOString()).text(n)}function p(t){k&&(localStorage.setItem(y,t||x.find("textarea[name=content]").val()),h(gettext("saved")))}function f(){k&&localStorage.removeItem(y)}function m(){if(y=d(),k){var e=localStorage.getItem(y),a=function(t){return(t||"").replace(/ /g,"&nbsp;")},n=t.trim(a(e)),i=a(x.find("textarea[name=content]").val().trim());e&&(n==i?f():c(e))}var o=function(){clearTimeout(w),w=setTimeout(p,3e3)};if(C)ace_editor.on&&ace_editor.on("change",o);else try{var s=t("#id_content");s.ckeditorGet&&s.ckeditorGet().on("key",o)}catch(r){console.log(r)}t(".btn-discard").on("click",function(){clearTimeout(w),f()})}function v(){var e=t("#page-attachments-table"),a=t("#page-attachments-count"),n=t("#page-attachments-button"),i=t("#page-attachments-no-message"),o=t("#page-attachments-new-table"),s=t("#page-attachments-form"),r=o.find("tbody tr").first(),l=o.find("tbody tr").last(),d=t("#page-attachments-spinner"),c=t("#page-attachments-upload-target"),u=(s.length&&s.attr("action"),!1);e.length&&(n.on("click",function(t){t.preventDefault(),o.toggleClass("hidden"),o.hasClass("hidden")||o.find("input[type=text]").first()[0].focus()}),t("#page-attachments-more").on("click",function(){function t(){var t=r.clone();return t.find("input, textarea").val(""),t.find(".attachment-error").remove(),t.insertBefore(l),t.addClass("dynamic-row"),t}u||t().find('input[type="text"]')[0].focus()}),t("<input type='hidden' name='is_ajax' value='1' />").appendTo(s),c.on("load",function(n){u=!1,s.data("disabled",!1).removeClass("disabled");try{var l,g,h=c.contents().find("textarea").first(),p=[],f=[];h.length?(g=JSON.parse(t.trim(h.val())),l=o.find(".dynamic-row"),t.each(g,function(n){if(this.id){var i=t(this.html);if(i.appendTo(e),i.addClass("new-row"),a.text(parseInt(a.text(),10)+1),mdn.wiki.attachments&&mdn.wiki.attachments.push(this),p.push(n),n){var o=l.eq(n)[0];l[n]="",o.parentNode.removeChild(o)}else r.find("input, textarea").val("")}else f.push(n)}),i.addClass("hidden"),e.removeClass("hidden"),p.length==g.length?(s[0].reset(),l.remove()):t.each(f,function(){0==this&&t('<div class="attachment-error"></div>').appendTo(r.find(".page-attachment-actions-file-cell")).text(g[this].error)})):console.warn("No textarea")}catch(n){console.warn("Exception! ",n)}d.css("opacity",0)}),s.attr("target","page-attachments-upload-target").on("submit",function(e){if(!u){o.find(".attachment-error").remove();var a=!0;return o.find("input[required], textarea[required]").each(function(){var n=t(this);""==n.val()?(e.preventDefault(),e.stopPropagation(),n.addClass("attachment-required"),a=!1):n.removeClass("attachment-required")}),a?void d.css("opacity",1):(u=!1,void setTimeout(function(){s.data("disabled",!1)},200))}}))}function _(){function a(t){var e=d.getCommand("mdn-buttons-save"),a=d.getCommand("mdn-buttons-save-exit"),n=CKEDITOR.TRISTATE_OFF;t||(n=CKEDITOR.TRISTATE_DISABLED),e&&e.setState(n),a&&a.setState(n)}function n(){t(".btn-save-and-edit").attr("disabled",!1),t(".btn-save").attr("disabled",!1),a(!0)}function i(){t(".btn-save-and-edit").attr("disabled",!0),t(".btn-save").attr("disabled",!0),a(!1)}function o(){d.resetDirty(),l.each(function(){var e=t(this),a=e.val();"checkbox"==e.attr("type")&&(a=this.checked),e.data("original",a)}),x.find(".dirty").removeClass("dirty"),x.trigger("mdn:clean")}function s(){var t=u;u=d.checkDirty(),u&&!t?x.find(".editor-container").addClass("dirty").trigger("mdn:dirty"):!u&&t&&x.find(".editor-container").removeClass("dirty").trigger("mdn:clean")}var r='input:not([type="hidden"]), textarea, select',l=x.find(r),d=CKEDITOR.instances.id_content;x.on("mdn:save-success",o).on("mdn:dirty",n).on("mdn:clean",function(){t(".dirty").length||i()});var c,u=!1;d.on("contentDom",function(){d.document.on("keyup",s),d.on("paste setData",s),c&&clearInterval(c),c=setInterval(s,1500)}),d.on("instanceReady",function(t){t.editor==d&&a(!1)}),t(e).on("beforeunload",function(){c&&clearInterval(c)}),x.on("change input",r,function(){var e=t(this),a=e.val(),n=e.attr("type");n&&"checkbox"==n.toLowerCase()&&(a=this.checked),a!==e.data("original")?e.hasClass("dirty")||e.addClass("dirty").trigger("mdn:dirty"):e.removeClass("dirty").trigger("mdn:clean")}),o()}!function(){var n=t("#id_content"),i=function(){var n=(t(".approved .boxed"),t("div.cke_toolbox")),i=t(".ckeditor-container"),o=t("#cke_id_content"),s=i.offset().top,r=!1;t(a).on("scroll",function(){var e=t(this).scrollTop();if(e>=s){if(e>i.height()+s-200)return void n.css("display","none");n.css("display",""),r||(r=!0,n.css({position:"fixed",top:0,width:o.width()-11}))}else r&&(r=!1,n.css({position:"relative",top:"auto",width:"auto"}))}),t(e).resize(function(){r&&n.css({width:i.width()-10})})};n.each(function(){t("body").is(".is-template")||t(this).removeAttr("required").ckeditor(i,{customConfig:"/en-US/docs/ckeditor_config.js"})})}(),function(){var e=t("#id_render_max_age").val(),a=function(e){return parseInt(t(e).val())||0},n=function(){t("#id_render_max_age").val(60*(60*(24*a(".duration-container #days")+a(".duration-container #hours"))+a(".duration-container #minutes")))};if(t(".duration-container input").on("change",n),""!==e){var i=Math.floor(e/86400);e-=86400*i;var o=Math.floor(e/3600);e-=3600*o;var s=Math.floor(e/60);t(".duration-container #days").val(i),t(".duration-container #hours").val(o),t(".duration-container #minutes").val(s)}else n()}(),function(){t(".doc-mode-btn").toggleMessage().on("click",function(e){e.preventDefault();var a=t(".translate-source textarea");t(".translate-rendered, .translate-source").toggleClass("hidden"),a.data("height")||(a.height(function(){return t(this).get(0).scrollHeight}),a.data("height",!0))}),t(".hide-original-btn").toggleMessage().on("click",function(e){e.preventDefault(),t("#trans-content").toggleClass("translate-only")})}(),t.fn.prepopulate=function(e,a){var n="_changed";return this.each(function(){var i=t(this);i.data(n,!1),i.on(n,function(){i.data(n,!0)});var o=function(){if(1!=i.data(n)){var o,s=[];e.each(function(){t(this).val().length>0&&s.push(t(this).val())});var r=s.join(" ");r=t.slugifyString(r,!1,!0),r=r.substring(0,a),o=i.val().split("/"),o[o.length-1]=r,i.val(o.join("/"))}};e.on("keyup change focus",o)})};var y,w,b,C,T,k="localStorage"in e,x=t("#wiki-page-edit");t(a).ready(n)}(jQuery,window,document),function(t){t.widget("ui.tagit",{options:{itemName:"item",fieldName:"tags",availableTags:[],tagSource:null,removeConfirmation:!1,caseSensitive:!0,allowSpaces:!1,singleField:!1,singleFieldDelimiter:",",singleFieldNode:null,tabIndex:null,onTagAdded:null,onTagRemoved:null,onTagClicked:null},_create:function(){var e=this;if(this.element.is("input")?(this.tagList=t("<ul></ul>").insertAfter(this.element),this.options.singleField=!0,this.options.singleFieldNode=this.element,this.element.css("display","none")):this.tagList=this.element.find("ul, ol").andSelf().last(),this._tagInput=t('<input type="text">').addClass("ui-widget-content"),this.options.tabIndex&&this._tagInput.attr("tabindex",this.options.tabIndex),this.options.tagSource=this.options.tagSource||function(a,n){var i=a.term.toLowerCase(),o=t.grep(e.options.availableTags,function(t){return 0===t.toLowerCase().indexOf(i)});n(e._subtractArray(o,e.assignedTags()))},this.tagList.addClass("tagit").addClass("ui-widget ui-widget-content").append(t('<li class="tagit-new"></li>').append(this._tagInput)).click(function(a){var n=t(a.target);n.hasClass("tagit-label")?e._trigger("onTagClicked",a,n.closest(".tagit-choice")):e._tagInput.focus()}),this.tagList.children("li").each(function(){t(this).hasClass("tagit-new")||(e.createTag(t(this).html(),t(this).attr("class")),t(this).remove())}),this.options.singleField)if(this.options.singleFieldNode){var a=t(this.options.singleFieldNode),n=a.val().split(this.options.singleFieldDelimiter);a.val(""),t.each(n,function(t,a){e.createTag(a)})}else this.options.singleFieldNode=this.tagList.after('<input type="hidden" style="display:none;" value="" name="'+this.options.fieldName+'">');this._tagInput.keydown(function(a){if(a.which==t.ui.keyCode.BACKSPACE&&""===e._tagInput.val()){var n=e._lastTag();!e.options.removeConfirmation||n.hasClass("remove")?e.removeTag(n):e.options.removeConfirmation&&n.addClass("remove ui-state-highlight")}else e.options.removeConfirmation&&e._lastTag().removeClass("remove ui-state-highlight");(a.which==t.ui.keyCode.COMMA||a.which==t.ui.keyCode.ENTER||a.which==t.ui.keyCode.TAB&&""!==e._tagInput.val()||a.which==t.ui.keyCode.SPACE&&e.options.allowSpaces!==!0&&('"'!=t.trim(e._tagInput.val()).replace(/^s*/,"").charAt(0)||'"'==t.trim(e._tagInput.val()).charAt(0)&&'"'==t.trim(e._tagInput.val()).charAt(t.trim(e._tagInput.val()).length-1)&&t.trim(e._tagInput.val()).length-1!==0))&&(a.preventDefault(),e.createTag(e._cleanedInput()),e._tagInput.autocomplete("close"))}).blur(function(){e.createTag(e._cleanedInput())}),(this.options.availableTags||this.options.tagSource)&&this._tagInput.autocomplete({source:this.options.tagSource,select:function(t,a){return""===e._tagInput.val()&&e.removeTag(e._lastTag(),!1),e.createTag(a.item.value),!1}})},_cleanedInput:function(){return t.trim(this._tagInput.val().replace(/^"(.*)"$/,"$1"))},_lastTag:function(){return this.tagList.children(".tagit-choice:last")},assignedTags:function(){var e=this,a=[];return this.options.singleField?(a=t(this.options.singleFieldNode).val().split(this.options.singleFieldDelimiter),""===a[0]&&(a=[])):this.tagList.children(".tagit-choice").each(function(){a.push(e.tagLabel(this))}),a},_updateSingleTagsField:function(e){t(this.options.singleFieldNode).val(e.join(this.options.singleFieldDelimiter))},_subtractArray:function(e,a){for(var n=[],i=0;i<e.length;i++)-1==t.inArray(e[i],a)&&n.push(e[i]);return n},tagLabel:function(e){return this.options.singleField?t(e).children(".tagit-label").text():t(e).children("input").val()},_isNew:function(t){var e=this,a=!0;return this.tagList.children(".tagit-choice").each(function(){return e._formatStr(t)==e._formatStr(e.tagLabel(this))?(a=!1,!1):void 0}),a},_formatStr:function(e){return this.options.caseSensitive?e:t.trim(e.toLowerCase())},createTag:function(e,a){if(that=this,e=t.trim(e),!this._isNew(e)||""===e)return!1;var n=t(this.options.onTagClicked?'<a class="tagit-label"></a>':'<span class="tagit-label"></span>').text(e),i=t("<li></li>").addClass("tagit-choice ui-widget-content ui-state-default").addClass(a).append(n),o=t("<span></span>").addClass("ui-icon ui-icon-close"),s=t('<a><span class="text-icon">×</span></a>').addClass("close").append(o).click(function(){that.removeTag(i)});if(i.append(s),this.options.singleField){var r=this.assignedTags();r.push(e),this._updateSingleTagsField(r)}else{var l=n.html();i.append('<input type="hidden" style="display:none;" value="'+l+'" name="'+this.options.itemName+"["+this.options.fieldName+'][]">')}this._trigger("onTagAdded",null,i),this._tagInput.val(""),this._tagInput.parent().before(i)},removeTag:function(e,a){if("undefined"==typeof a&&(a=!0),e=t(e),this._trigger("onTagRemoved",null,e),this.options.singleField){var n=this.assignedTags(),i=this.tagLabel(e);n=t.grep(n,function(t){return t!=i}),this._updateSingleTagsField(n)}a?e.fadeOut("fast",function(){e.remove()}).dequeue():e.remove()},removeAll:function(){var t=this;this.tagList.children(".tagit-choice").each(function(e,a){t.removeTag(a,!1)})}})}(jQuery),function(t){"use strict";function e(e){return function(a,n){var s=t("#page-tags .tagit-choice"),r=[];e||s.push(n),s.each(function(){e&&this===n[0]||r.push('"'+t(this).find(".tagit-label").text()+'"')}),i.val(r.join(",")),window.waffle&&window.waffle.flag_is_active("dirtiness_tracking")&&(void 0!==o&&i.val()!==o?t("#page-tags").addClass("dirty").trigger("mdn:dirty"):t("#page-tags").removeClass("dirty").trigger("mdn:clean"))}}var a=t("#wiki-page-edit"),n=t("#tagit_tags"),i=t('<input type="hidden" name="tags" id="hiddenTags" value="'+(n.val()||"")+'" />').appendTo("#page-tags");if(n.tagit({availableTags:mdn.wiki.tagSuggestions||[],singleField:!0,allowSpaces:!0,singleFieldNode:n,onTagAdded:e(),onTagRemoved:e(!0)}),t(".tagit-new input").attr("placeholder",gettext("New tag...")),n.remove(),window.waffle&&window.waffle.flag_is_active("dirtiness_tracking")){var o=i.val();a.on("mdn:save-success",function(){o=i.val()})}}(jQuery);