{{ revisions|paginator }}

{% if revisions.count %}
    <table class="dashboard-table" width="100%">
        <thead>
            <tr>
                <th class="dashboard-revision">Revision</th>
                <th class="dashboard-title">Title</th>
                <th class="dashboard-comment">Comment</th>
                <th class="dashboard-author">Author{% if show_ips %} <button id="show_ips_btn">Toggle IPs</button>{% endif %}</th>
                {% if show_spam_submission %}
                <th class="dashboard-spam">Akismet</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for revision in revisions %}
                {% set previous_id = revision.previous.id %}
                {% set revision_url = revision.document.get_absolute_url() %}
                <tr
                    tabindex="0"
                    class="dashboard-row {% if not previous_id %}dashboard-row-new{% endif %}"
                    data-revision-id="{{ revision.id }}"
                    data-previous-id="{{ previous_id }}"
                    data-view-url="{{ revision_url }}"
                    data-edit-url="{{ revision.document.get_edit_url() }}"
                    data-compare-url="{{ url('wiki.compare_revisions', revision.document.slug, locale=revision.document.locale) }}?from={{ previous_id if previous_id else revision.id }}&amp;to={{ revision.id }}&amp;raw=1"
                    data-revert-url="{{ url('wiki.revert_document', revision.document.slug, revision.id, locale=revision.document.locale) }}"
                    data-history-url="{{ url('wiki.document_revisions', revision.document.slug, locale=revision.document.locale) }}">
                    <td class="dashboard-revision">
                        <a href="{{ url('wiki.revision', revision.document.slug, revision.id) }}">{{ datetimeformat(revision.created, format='datetime') }}</a>
                        <br />
                        <span class="locale">{{ revision.document.locale }}</span>
                        {% if not previous_id %}<span class="new">{{ _('new') }}</span>{% endif %}
                        {% if revision.document.deleted %}<span class="deleted">{{ _('deleted') }}</span>{% endif %}
                    </td>
                    <td class="dashboard-title">
                        <a href="{{ revision_url }}">{{ revision.title }}</a>
                        <span class="dashboard-slug">{{ revision.document.slug }}</span>
                    </td>
                    <td class="dashboard-comment">
                        {{ format_comment(revision) }}
                    </td>
                    <td class="dashboard-author">
                        <a href="{{ revision.creator.get_absolute_url() }}">{{ revision.creator }}</a>
                        {% set revision_ip = revision.revisionip_set.first() %}
                        {% if show_ips and revision_ip %}
                        <dl class="revision_ip compact">
                            <dt>{{ _('IP:') }}</dt>
                            <dd>{{ revision_ip.ip }}</dd>
                            {% if revision_ip.user_agent %}
                            <dt>{{ _('User agent:') }}</dt>
                            <dd>{{ revision_ip.user_agent }}</dd>
                            {% endif %}
                            {% if revision_ip.referrer %}
                            <dt>{{ _('Referrer:') }}</dt>
                            <dd>{{ revision_ip.referrer }}</dd>
                            {% endif %}
                            {% set ban_ip_url = url('admin:core_ipban_add')|urlparams(ip=revision_ip.ip) %}
                        </dl>
                        <a class="dashboard-ban-ip-link" href="{{ ban_ip_url }}" target="_blank">{{ _('Ban IP from Editing') }}</a>
                        {% endif %}
                        {% if request.user.is_superuser and revision.creator.active_ban %}
                            <div class="banned">
                            {{ _('banned %(ban_date)s by %(user)s',
                                 ban_date=datetimeformat(revision.creator.active_ban.date, format='date'),
                                 user=user_display(revision.creator.active_ban.by)) }}
                            </div>
                        {% endif %}
                    </td>
                    {% if show_spam_submission %}
                    <td class="dashboard-spam">
                        {% set submissions = revision.akismet_submissions.all() %}
                        {% if submissions.count() > 0 %}
                        <dl class="compact">
                            <dt>{{ _('Sent as') }}</dt>
                            {% for submission in submissions %}
                            <dd>
                                {{ _('%(submission_type)s at %(sent_date)s by %(user)s',
                                     submission_type=submission.type,
                                     sent_date=datetimeformat(submission.sent, format='datetime'),
                                     user=user_display(submission.sender)) }}
                            </dd>
                            {% endfor %}
                        </dl>
                        {% endif %}
                        {% set spam_submission_url = url('admin:wiki_revisionakismetsubmission_add')|urlparams(revision=revision.id, type='spam') %}
                        {% set ham_submission_url = url('admin:wiki_revisionakismetsubmission_add')|urlparams(revision=revision.id, type='ham') %}
                        {{ _('Submit as') }} <a class="button" href="{{ spam_submission_url }}" target="_blank">{{ _('spam') }}</a>
                        <a class="button" href="{{ ham_submission_url }}" target="_blank">{{ _('ham') }}</a>
                    </td>
                    {% endif %}
                </tr>
            {% endfor %}
        </tbody>
    </table>

{% else: %}

    <p>{{ _('There are no revisions matching this filter set.') }}</p>

{% endif %}

{{ revisions|paginator }}
