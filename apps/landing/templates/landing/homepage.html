{% extends "base.html" %}

{% block body_attributes %}id="home"{% endblock %}

{% block extrahead %}
  <meta name="google-site-verification" content="Phj8dHc2oKwic3FGPsKIhdOBk_1wnCTnKwjcjiLgJPc">
  <meta name="google-site-verification" content="TH9rA27HbfjO_XqYWTIPrW1E7E7Dtgsh7ULzHi3UTVA">

  {% set seo_description = _('The Mozilla Developer Network (MDN) provides information about Open Web technologies including HTML, CSS, and APIs for both Web sites and HTML5 Apps. It also documents Mozilla products, like Firefox OS.') %}
  {% set social_title = 'Mozilla Developer Network' %}
  <meta property="og:description" content="{{ seo_description }}">
  <meta name="description" content="{{ seo_description }}">
  <meta name="twitter:description" content="{{ seo_description }}">
  <meta name="twitter:title" content="{{ social_title }}">
  <meta property="og:title" content="{{ social_title }}">

  {{ css('home') }}
  <style type="text/css" media="screen">
  .search-wrapper {
/*      border: 1px black dotted;
      padding: 3px;
      border-radius: 5px;*/
  }

  .filters {
      display: inline;
  }

  .filters span.topic{
      display: inline;
      border: 2px violet dashed;
      margin: 0 0.1em;
  }

  .filters span.topic button.close{
      width: 30px;
      height: 30px;
  }

  .search-wrapper input{
      display: inline;
  }

  .search .suggestions{
      width: 600px;
      height: 200px;

      border: 1px violet dotted;
  }
  </style>
  <script>
      document.addEventListener('DOMContentLoaded', function listener(){
          "use strict";

          // https://developer.mozilla.org/en-US/search.json?q=html5&per_page=100&topic=javascript&topic=html

          var filtersData = window.mdn.searchFilters;


          /*var xhr = new XMLHttpRequest();
          xhr.open('GET', SEARCH_URL);

          xhr.addEventListener('load', function(e){
              console.log(xhr.responseText);
          });

          xhr.addEventListener('error', function(e){
              console.error(xhr.responseText);
          });

          xhr.send();*/

          function parse(s){
              var matches = s.match(/^(#\S+)\s+|\s(#\S+)\s+/);
              return matches ? matches[1] || matches[2] : matches;
          }


          var search = $('.search-wrapper');
          var searchFilters = search.find('.filters');
          var searchInput = search.find('input');
          var searchForm = search.find('form');
          var suggestions = $('form.search .suggestions');
          var BASE_SEARCH_URL = '{{ url('search') }}';

          var previousValue = searchInput.val(); // it happens that the content is kept across refreshes

          // f is a topic with the # ('#javascript', '#advanced')
          function addFilter(f){
              var filter = $('<span></span>')
                  .addClass('topic')
                  .attr('data-topic', f.slice('#'.length))
                  .text(f)
                  .appendTo(searchFilters);

              $('<button></button>')
                  .addClass('close')
                  .attr('type', 'button')
                  .text('x')
                  .on('click', function(){
                      $(filter).remove();
                  })
                  .appendTo(filter);
          }

          function parseAndAddFilters(){
              var toParse = searchInput.val();
              var filter = true;
              var filters = [];
              while(filter){
                  filter = parse(toParse);
                  if(filter){
                      filters.push(filter);
                      toParse = toParse.replace(filter, '').trim();
                  }
              }

              if(filters.length >= 1){

                  filters.forEach(addFilter);
                  suggestions.attr('hidden', 'hidden');
              }

              searchInput.val(toParse);
          }
          function removeAccents(srt) {
              var map={'À':'A','Á':'A','Â':'A','Ã':'A','Ä':'A','Å':'A','Æ':'AE','Ç':'C','È':'E','É':'E','Ê':'E','Ë':'E','Ì':'I','Í':'I','Î':'I','Ï':'I','Ð':'D','Ñ':'N','Ò':'O','Ó':'O','Ô':'O','Õ':'O','Ö':'O','Ø':'O','Ù':'U','Ú':'U','Û':'U','Ü':'U','Ý':'Y','ß':'s','à':'a','á':'a','â':'a','ã':'a','ä':'a','å':'a','æ':'ae','ç':'c','è':'e','é':'e','ê':'e','ë':'e','ì':'i','í':'i','î':'i','ï':'i','ñ':'n','ò':'o','ó':'o','ô':'o','õ':'o','ö':'o','ø':'o','ù':'u','ú':'u','û':'u','ü':'u','ý':'y','ÿ':'y','Ā':'A','ā':'a','Ă':'A','ă':'a','Ą':'A','ą':'a','Ć':'C','ć':'c','Ĉ':'C','ĉ':'c','Ċ':'C','ċ':'c','Č':'C','č':'c','Ď':'D','ď':'d','Đ':'D','đ':'d','Ē':'E','ē':'e','Ĕ':'E','ĕ':'e','Ė':'E','ė':'e','Ę':'E','ę':'e','Ě':'E','ě':'e','Ĝ':'G','ĝ':'g','Ğ':'G','ğ':'g','Ġ':'G','ġ':'g','Ģ':'G','ģ':'g','Ĥ':'H','ĥ':'h','Ħ':'H','ħ':'h','Ĩ':'I','ĩ':'i','Ī':'I','ī':'i','Ĭ':'I','ĭ':'i','Į':'I','į':'i','İ':'I','ı':'i','Ĳ':'IJ','ĳ':'ij','Ĵ':'J','ĵ':'j','Ķ':'K','ķ':'k','Ĺ':'L','ĺ':'l','Ļ':'L','ļ':'l','Ľ':'L','ľ':'l','Ŀ':'L','ŀ':'l','Ł':'L','ł':'l','Ń':'N','ń':'n','Ņ':'N','ņ':'n','Ň':'N','ň':'n','ŉ':'n','Ō':'O','ō':'o','Ŏ':'O','ŏ':'o','Ő':'O','ő':'o','Œ':'OE','œ':'oe','Ŕ':'R','ŕ':'r','Ŗ':'R','ŗ':'r','Ř':'R','ř':'r','Ś':'S','ś':'s','Ŝ':'S','ŝ':'s','Ş':'S','ş':'s','Š':'S','š':'s','Ţ':'T','ţ':'t','Ť':'T','ť':'t','Ŧ':'T','ŧ':'t','Ũ':'U','ũ':'u','Ū':'U','ū':'u','Ŭ':'U','ŭ':'u','Ů':'U','ů':'u','Ű':'U','ű':'u','Ų':'U','ų':'u','Ŵ':'W','ŵ':'w','Ŷ':'Y','ŷ':'y','Ÿ':'Y','Ź':'Z','ź':'z','Ż':'Z','ż':'z','Ž':'Z','ž':'z','ſ':'s','ƒ':'f','Ơ':'O','ơ':'o','Ư':'U','ư':'u','Ǎ':'A','ǎ':'a','Ǐ':'I','ǐ':'i','Ǒ':'O','ǒ':'o','Ǔ':'U','ǔ':'u','Ǖ':'U','ǖ':'u','Ǘ':'U','ǘ':'u','Ǚ':'U','ǚ':'u','Ǜ':'U','ǜ':'u','Ǻ':'A','ǻ':'a','Ǽ':'AE','ǽ':'ae','Ǿ':'O','ǿ':'o'};
              var valueResult='';
              for (var i=0;i<srt.length;i++) {
                  var c=srt.charAt(i);
                  valueResult+=map[c]||c;
              }
              return valueResult;
          }

          function recoverTopics(f){
              // clean suggestion div
              suggestions.empty();
              $.each(filtersData, function(index, group){
                  var title = $('<strong>').text(group.name);
                  var ul = document.createElement("UL");
                  var show = false;
                  $.each(group.filters, function(index, filter){
                      var slugNorm = filter.slug.toLowerCase();
                      var nameNorm = removeAccents(filter.name.toLowerCase());
                      if (!f || slugNorm.indexOf(removeAccents(f.toLowerCase())) != -1 || nameNorm.indexOf(removeAccents(f.toLowerCase())) != -1) {
                          var $li = $('<li></li>')
                                      .attr('id', filter.slug);
                          var $a = $('<a></a>')
                                      .attr('href', '#')
                                      .text(filter.name + ' : #' + filter.slug)
                                      .appendTo($li)
                                      .on('click', function(){
                                          addFilter('#'+filter.slug);
                                          searchInput.val(searchInput.val().replace('#'+f,""));
                                          previousValue = searchInput.val();
                                          suggestions.attr('hidden', 'hidden');
                                          searchInput.focus();
                                      });
                          $(ul).append($li);
                          show = true;
                      }
                  });
                  if(show){
                      suggestions.append(title);
                      suggestions.append(ul);
                  }
              });
          }

          // Open Q : other events than input?
          searchInput.on('input', function(e){

              parseAndAddFilters();

              // find out if there is a difference of exactly one # between input.value and previousValue
              // Current algorithm is very simple. Must be improved in the future
              // Currently consider only the last character
              if(searchInput.val().length - previousValue.length === 1 &&
                 searchInput.val()[searchInput.val().length -1] === '#')
              {
                  console.log('show');
                  suggestions.removeAttr('hidden');
              }

              if(!suggestions.attr('hidden'))
              {
                  var fs = searchInput.val().match(/#(\S+)/) || [];
                  recoverTopics(fs[1] || '');
              }

              if(previousValue.length - searchInput.val().length === 1 &&
                 previousValue[previousValue.length -1] === '#')
              {
                  suggestions.attr('hidden', 'hidden');
              }

              previousValue = searchInput.val();
          });

          $('form.search').on('submit', function(e){
              e.preventDefault();

              var topics = $.makeArray($('form.search .topic')).map(function(e){
                  return encodeURIComponent($(e).attr('data-topic'));
              });
              var topicsString = topics
                  .map(function(t){ return 'topic='+t; })
                  .join('&');

              var q = encodeURIComponent(searchInput.val());

              var searchURL = BASE_SEARCH_URL + '?' +
                  'q=' + q +
                  '&' + topicsString;

              console.log('search URL', searchURL);
              location.href = searchURL;
          })

          document.removeEventListener('DOMContentLoaded', listener);
      });
  </script>
{% endblock %}

{% block content %}

<!-- top search area -->
<div class="home-masthead"><div class="center">

  <h1>{{ _('Shared knowledge <span>for the Open Web</span>') }}</h1>

  <div class="home-search-form">
    <form action="{{ url('search') }}" method="get" class="search">
      <div class="search-wrapper">
        <div class="filters"></div>
        <label for="home-q" class="offscreen">{{ _('Search') }}</label>
        <input type="search" id="home-q" name="q" autocomplete="off" placeholder="{{ _('Search the docs') }}" />
        <button type="submit" class="offscreen">{{ _('Search') }}</button>
      </div>
      <ul class="suggestions" hidden>
    </form>
  </div>

  <div class="home-features">
    <h2 class="offscreen">{{ _('Web Technologies') }}</h2>
    <div class="column-container">
      <div class="column-home-features">
        <h3><i aria-hidden="true" class="icon-file-text-alt"></i><span>{{ _('Web<br />Platform') }}</span></h3>
        <ul>
          <li><a href="{{ devmo_url('Web/Reference/API') }}">{{ _('Web APIs &amp; DOM') }}</a></li>
          <li><a href="{{ devmo_url('Web/HTML') }}">{{ _('HTML') }}</a> &amp; <a href="{{ devmo_url('Web/Guide/HTML/HTML5') }}">{{ _('HTML5') }}</a></li>
          <li><a href="{{ devmo_url('Web/CSS') }}">{{ _('CSS') }}</a> &amp; <a href="{{ devmo_url('Web/CSS/CSS3') }}">{{ _('CSS3') }}</a></li>
          <li><a href="{{ devmo_url('Web/JavaScript') }}">{{ _('JavaScript') }}</a></li>
          <li><a href="{{ devmo_url('Web') }}">{{ _('more...') }}</a></li>
        </ul>
      </div>
      <div class="column-home-features">
        <h3 class="zones"><i aria-hidden="true" class="icon-suitcase"></i><span>{{ _('Zones') }}</span></h3>
        <ul>
          <li><a href="{{ devmo_url('Firefox') }}">{{ _('Firefox') }}</a></li>
          <li><a href="{{ devmo_url('Firefox_OS') }}">{{ _('Firefox OS') }}</a></li>
          <li><a href="{{ devmo_url('Mozilla/Marketplace') }}">{{ _('Firefox Marketplace') }}</a></li>
          <li><a href="{{ devmo_url('Apps') }}">{{ _('App Center') }}</a></li>
          <li><a href="{{ devmo_url('Mozilla/Add-ons') }}?menu">{{ _('Add-ons') }}</a></li>
        </ul>
      </div>
      <div class="column-home-features">
        <h3><i aria-hidden="true" class="icon-wrench"></i><span>{{ _('Developer<br />Tools') }}</span></h3>
        <ul>
        <li><a href="{{ devmo_url('Mozilla/Firefox_OS/Using_the_App_Manager') }}">{{ _('Firefox OS App Manager') }}</a></li>
        <li><a href="{{ devmo_url('Tools/Page_Inspector') }}">{{ _('Page Inspector') }}</a></li>
        <li><a href="{{ devmo_url('Tools/Debugger') }}">{{ _('JavaScript Debugger') }}</a></li>
        <li><a href="{{ devmo_url('Tools/Web_Console') }}">{{ _('Web Console') }}</a></li>
        <li><a href="{{ devmo_url('Tools') }}">{{ _('more...') }}</a></li>
        </ul>
      </div>
      <div class="column-home-features">
        <h3><i aria-hidden="true" class="icon-certificate"></i><span>{{ _('Developer<br />Program') }}</span></h3>
        {# <h3><i aria-hidden="true" class="icon-beaker"></i><span>{{ _('MDN<br />Beta') }}</span></h3> #}
        <p>{{ _('Get Web technology news from Mozilla, get help from other developers, and more!') }}</p>
        <p><a href="{{ devmo_url('Mozilla/Developer_Program') }}">{{ _('Learn more and sign up!') }}</a></p>
      </div>
    </div>
  </div>

</div></div>

<!-- callout area -->
<div class="home-callouts">
  <h2 class="offscreen">{{ _('Open Web and Mobile') }}</h2>
  <div class="column-container center">
    <div class="column-callout callout-apps">
      <a href="{{ devmo_url('Web/Apps') }}"><span>{{ _('Create<br />Web Apps') }}</span><i></i></a>
    </div>
    <div class="column-callout callout-android">
      <a href="{{ devmo_url('Mozilla/Firefox_for_Android') }}"><span>{{ _('Develop<br />Firefox for Android') }}</span><i></i></a>
    </div>
    <div class="column-callout callout-firefoxos">
      <a href="/en-US/docs/Mozilla/Firefox_OS"><span>{{ _('Build<br />Firefox OS') }}</span><i></i></a>
    </div>
  </div>
</div>

<!-- hacks area -->
<div class="home-hacks"><div class="column-container center">
  <div class="column-hacks">
    <h2><i aria-hidden="true" class="icon-star"></i> Hacks Blog<span class="heading-link">{{ _('<a href="http://hacks.mozilla.org">read more at hacks.mozilla.org <i aria-hidden="true" class="icon-arrow-right"></i></a></span>') }}</h2>
    {{ newsfeed(updates, section_headers=True) }}
  </div>
  <div class="column-involved">
    <div class="home-involved-card"><a href="{{ devmo_url('Project:MDN/Contributing') }}">
      <h2 class="title">{{ _('Get Involved') }}</h2>

      <p class="numbers">{{ _('<span class="row1">Join <span class="number">3,414</span> contributors</span> <span class="row2">in <span class="number">31</span> languages and locales</span> <span class="row3">around the world.</span>') }}</p>
      <p><span class="button">{{ _('Help improve MDN') }}</span></p>
    </a></div>
  </div>
</div></div>

<!-- demos and dev derby -->
{% if demos %}
<div class="home-demos"><div class="center">

{% if not waffle.flag('derby_closed') %}
  <div class="preview">
    <span>{{ _('Next Dev Derby: <strong>July 2013</strong>') }}</span>
    <span>{{ _('Subject: <strong>File API</strong>') }}</span>
  </div>
{% endif %}

<h2><i aria-hidden="true" class="icon-magic blue"></i> {{ _('See & submit demos') }}
  {% if not waffle.flag('derby_closed') %}
    <a href="{{ url('demos_devderby_landing') }}" class="heading-link">{{ _('MDN Dev Derby <i aria-hidden="true" class="icon-arrow-right"></i>') }}</a>
  {% else %}
    <a href="{{ url('demos') }}" class="heading-link">{{ _('MDN Demo Studio <i aria-hidden="true" class="icon-arrow-right"></i>') }}</a>
  {% endif %}
</h2>
<div class="home-demos-list">
  {% set extra_class = cycler(' row-first', '')%}
  {% for submission in demos %}
      {{ submission_thumb(submission, extra_class, thumb_width="180", thumb_height="133", is_homepage=True) }}
  {% endfor %}
  </div>
</div></div>
{% endif %}

<!-- contributions section -->
<div class="home-contribute"><div class="center">
  <h2><i aria-hidden="true" class="icon-smile"></i> {{ _('Help improve MDN') }}</h2>

  <div class="column-container">
    <div class="column-half">
      <p>{{ _('All parts of MDN (docs, demos, and the site itself) are created by an open community of developers. Please join us! Pick one of these ways to help:') }}</p>
    </div>
    <div class="column-half">
      <div class="column-container">
        <div class="column-half">
          <ul>
            <li><a href="{{ devmo_url('MDN/Getting_started') }}">{{ _('Getting started') }}</a></li>
            <li><a href="{{ devmo_url('MDN/Contribute/Howto/Do_an_editorial_review') }}">{{ _('Editorial review') }}</a></li>
            <li><a href="{{ devmo_url('MDN/Contribute/Howto/Do_a_technical_review') }}">{{ _('Technical review') }}</a></li>
          </ul>
        </div>
        <div class="column-half">
          <ul>
            <li><a href="{{ devmo_url('MDN/Contribute/Localize/Translating_pages') }}">{{ _('Translating') }}</a></li>
            <li><a href="{{ devmo_url('MDN/Promote') }}">{{ _('Promoting MDN') }}</a></li>
            <li><a href="https://github.com/mozilla/kuma#readme">{{ _('Contributing to the MDN codebase') }}</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div></div>
{% endblock %}

{% block js %}
  {{ super() }}
  {{ js('home', async=True) }}
{% endblock %}
