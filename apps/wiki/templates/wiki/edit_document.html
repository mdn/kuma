{# vim: set ts=2 et sts=2 sw=2: #}
{% extends "wiki/base.html" %}
{% from "layout/errorlist.html" import errorlist %}
{% from "wiki/includes/sidebar_modules.html" import document_tabs %}
{% set title = _('Edit Article | {document}')|f(document=document.title) %}
{% block title %}{{ page_title(title) }}{% endblock %}
{# TODO: Change KB url to landing page when we have one #}
{% set crumbs = [(url('wiki.category', document.category), document.get_category_display()),
                 (document.get_absolute_url(), document.title),
                 (None, _('Edit Article'))] %}
{% set classes = 'edit' %}
{% block bodyclass %}edit{% endblock %}

{% block content %}
<section id="content">
  <div class="wrap">
    <div id="content-main" class="full">
  <article id="edit-document" class="article" role="main">
    {{ errorlist(revision_form) }}
    <form id="wiki-page-edit" class="editing" method="post" action="">
      <fieldset>
        <header id="article-head">

          <div class="title">
            <h1>{{ _('Editing <em>{title}</em>')|fe(title=revision.title) }}</h1>
            {% if not section_id %}
                <button type="button" id="btn-properties" title="Edit Page Title and Properties">{{ _('Edit Page Title and Properties') }}</button>
            {% endif %}
            <p class="save-state" id="draft-status">{% trans %}Draft <span id="draft-action"></span> <time id="draft-time" class="timeago" title=""></time>{% endtrans %}</p>
          </div>

          {% if revision_form and not section_id %}
            <ul class="metadata">
                <li><label>{{_('Title:')}}</label> {{ revision_form.title | safe }}</li>
                <li><label>{{_('Slug:')}}</label> {{ revision_form.slug | safe }}</li>
                <li><label>{{_('Keywords:')}}</label> {{ revision_form.keywords | safe }}</li>
            </ul>
          {% endif %}

          {% include 'wiki/includes/page_buttons.html' %}

        </header>
        {% if revision_form %}
            {{ revision_form.content | safe }}
            <input type="hidden" name="form" value="rev" />
          <section>
          <h4>{{_('Review needed?')}}</h4>
            {{ revision_form.review_tags|safe }}
          </section>
        {% endif %}
      </fieldset>
    </form>
    <div id="preview"></div>
  </article>
    </div>
   </div>
</section>
{% endblock %}

{% block side_top %}
  {{ document_tabs(document, document.parent, user, 'edit', settings) }}
{% endblock %}

{% block site_js %}
    {{ super() }}
    {{ js('framebuster') }}
{% endblock %}
