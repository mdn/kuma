branches: master
language: minimal
git: { submodules: false }
jobs:
    include:
        - name: "Documentation"
          language: python
          python: 3.8
          cache: pip
          install:
            - pip install -r docs/requirements.txt
          script:
            - sphinx-build -b html -d doctrees docs html
        - name: "Python linting"
          language: python
          python: 3.8
          cache: pip
          install:
            - >-
              pip install --disable-pip-version-check
              black flake8 flake8-import-order
          script:
            - "! git grep -n '^<<<<<<< '"  # Check for Git conflict markers
            - flake8 kuma docs tests
            - black --check --diff kuma docs tests
        - name: "Python testing"
          language: python
          python: 3.8
          services: docker
          git: { submodules: true }
          env:
            UID=0
            DOCKER_COMPOSE_VERSION=1.23.2
          cache:
            directories:
              - downloads
              - build
              - static
          script:
            - set -e
            - scripts/ci-python
            - scripts/ci-jest
            - scripts/ci-localerefresh
            - bash <(curl -s https://codecov.io/bash)
        - name: "Javascript linting"
          language: node_js
          node_js: 10
          cache: npm
          script:
            - scripts/ci-jslint
            - scripts/ci-flow
